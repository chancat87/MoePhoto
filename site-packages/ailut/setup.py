import os
import os.path as osp
from setuptools import setup, find_packages
from torch.utils.cpp_extension import BuildExtension, CUDAExtension

os.chdir(osp.dirname(osp.abspath(__file__)))
if 'CONDA_PREFIX' in os.environ:
    library_dirs=[osp.join(os.environ['CONDA_PREFIX'], 'Lib/x64')]
else:
    library_dirs = []
setup(
    name='ailut',
    version='1.5.0',
    description='Adaptive Interval 3D LookUp Table Transform',
    author='Charles',
    author_email='charles.young@sjtu.edu.cn',
    packages=find_packages(),
    include_package_data=False,
    ext_modules=[
        CUDAExtension('ailut._ext', [
            osp.join('csrc', 'ailut_transform.cpp'),
            osp.join('csrc', 'ailut_transform_cpu.cpp'),
            osp.join('csrc', 'ailut_transform_cuda.cu')
        ],
        library_dirs=library_dirs,
        extra_compile_args={'cxx': [],
                            'nvcc':['-O3','--use_fast_math']})
    ],
    cmdclass={
        'build_ext': BuildExtension
    },
    classifiers=[
        'Development Status :: 4 - Beta',
        'License :: OSI Approved :: Apache Software License',
        'Operating System :: OS Independent',
        'Programming Language :: Python :: 3',
        'Programming Language :: Python :: 3.6',
        'Programming Language :: Python :: 3.7',
        'Programming Language :: Python :: 3.8',
        'Programming Language :: Python :: 3.9',
    ],
    license='Apache License 2.0',
    zip_safe=False
)